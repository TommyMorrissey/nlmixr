<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using Broom with nlmixr â€¢ nlmixr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using Broom with nlmixr">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">nlmixr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.0.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa fas fa-book"></span>
     
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    <li class="dropdown-header">Getting started</li>
    <li>
      <a href="../articles/running_nlmixr.html">Introduction to Running Nlmixr</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Going further</li>
    <li>
      <a href="../articles/modelPiping.html">Model Piping</a>
    </li>
    <li>
      <a href="../articles/broom.html">Sweeping models to tidy datasets (broom)</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa fas fa-chalkboard-teacher"></span>
     
    Example models
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/addingCovariances.html">Phenobarbatol with covariances</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://github.com/nlmixrdevelopment/nlmixr/raw/master/CheatSheet_nlmixr.pdf">
    <span class="fas fa fas fa-scroll"></span>
     
    Cheat Sheet
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    Functions
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/nlmixrdevelopment/nlmixr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/nlmixrdevelopment/nlmixr/releases">
    <span class="fa fa-download"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Using Broom with nlmixr</h1>
            
            <h4 class="date">2019-04-24</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/nlmixrdevelopment/nlmixr/blob/master/vignettes/broom.Rmd"><code>vignettes/broom.Rmd</code></a></small>
      <div class="hidden name"><code>broom.Rmd</code></div>

    </div>

    
    
<div class="figure">
<img src="logo.png" alt="nlmixr"><p class="caption">nlmixr</p>
</div>
<div id="the-broom-and-broom-mixed-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#the-broom-and-broom-mixed-packages" class="anchor"></a>The broom and broom.mixed packages</h2>
<p><code>broom</code> and <code>broom.mixed</code> are packages that attempt to put standard model outputs into data frames. nlmixr supports the <code>tidy</code> and <code>glance</code> methods but does not support <code>augment</code> at this time.</p>
<p>Using a model with a covariance term, the <a href="addingCovariances.html">Phenobarbital model</a>, we can explore the different types of output that is used in the tidy functions.</p>
<p>To explore this, first we run the model:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(nlmixr)
## To allow nlmixr to reload runs without large run times
## To run the actual models on your system, take the save options off.
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/options">options</a></span>(<span class="dt">nlmixr.save=</span><span class="ot">TRUE</span>,
        <span class="dt">nlmixr.save.dir=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.file">system.file</a></span>(<span class="dt">package=</span><span class="st">"nlmixr"</span>));

pheno &lt;-<span class="st"> </span><span class="cf">function</span>() {
  <span class="kw"><a href="../reference/ini.html">ini</a></span>({
    tcl &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">log</a></span>(<span class="fl">0.008</span>) <span class="co"># typical value of clearance</span>
    tv &lt;-<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">log</a></span>(<span class="fl">0.6</span>)   <span class="co"># typical value of volume</span>
    ## var(eta.cl)
    eta.cl <span class="op">+</span><span class="st"> </span>eta.v <span class="op">~</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, 
                       <span class="fl">0.01</span>, <span class="dv">1</span>) ## cov(eta.cl, eta.v), var(eta.v)
                      <span class="co"># interindividual variability on clearance and volume</span>
    add.err &lt;-<span class="st"> </span><span class="fl">0.1</span>    <span class="co"># residual variability</span>
  })
  <span class="kw"><a href="../reference/model.html">model</a></span>({
    cl &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(tcl <span class="op">+</span><span class="st"> </span>eta.cl) <span class="co"># individual value of clearance</span>
    v &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(tv <span class="op">+</span><span class="st"> </span>eta.v)    <span class="co"># individual value of volume</span>
    ke &lt;-<span class="st"> </span>cl <span class="op">/</span><span class="st"> </span>v            <span class="co"># elimination rate constant</span>
    d<span class="op">/</span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/TDist">dt</a></span>(A1) =<span class="st"> </span><span class="op">-</span><span class="st"> </span>ke <span class="op">*</span><span class="st"> </span>A1    <span class="co"># model differential equation</span>
    cp =<span class="st"> </span>A1 <span class="op">/</span><span class="st"> </span>v             <span class="co"># concentration in plasma</span>
    cp <span class="op">~</span><span class="st"> </span><span class="kw">add</span>(add.err)       <span class="co"># define error model</span>
  })
}

fit &lt;-<span class="st"> </span><span class="kw"><a href="../reference/nlmixr.html">nlmixr</a></span>(pheno, pheno_sd, <span class="st">"saem"</span>)
<span class="co">#&gt; Loading model already run (/home/matt/R/x86_64-pc-linux-gnu-library/3.5/nlmixr/nlmixr-pheno-pheno_sd-saem-4e1d75f610dfc7b582af6cceee46bc57.rds)</span></code></pre></div>
</div>
<div id="glancing-at-the-goodness-of-fit-metrics" class="section level1">
<h1 class="hasAnchor">
<a href="#glancing-at-the-goodness-of-fit-metrics" class="anchor"></a>Glancing at the goodness of fit metrics</h1>
<p>Often in fitting data, you would want to <code>glance</code> at the fit to see how well it fits. In <code>broom</code>, <code>glance</code> will give a summary of the fit metrics of goodness of fit:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/generics/topics/glance">glance</a></span>(fit)
<span class="co">#&gt; # A tibble: 1 x 5</span>
<span class="co">#&gt;    OBJF   AIC   BIC logLik conditionNumber</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;           &lt;dbl&gt;</span>
<span class="co">#&gt; 1  722. 1019. 1037.  -503.            7.46</span></code></pre></div>
<p>Note in nlmixr it is possible to have more than one fit metric (based on different quadratures, FOCEi approximation etc). However, the <code>glance</code> only returns the fit metrics that are current.</p>
<p>If you add conditional weighted residuals to the fit the objective function is changed to the <code>FOCEi</code> metric:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit &lt;-<span class="st"> </span>fit <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/addCwres.html">addCwres</a></span>()
<span class="co">#&gt; Calculating residuals/tables</span>
<span class="co">#&gt; done.</span></code></pre></div>
<p>Now the glance gives the <code>FOCEi</code> values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/generics/topics/glance">glance</a></span>(fit)
<span class="co">#&gt; # A tibble: 1 x 5</span>
<span class="co">#&gt;    OBJF   AIC   BIC logLik conditionNumber</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;           &lt;dbl&gt;</span>
<span class="co">#&gt; 1  689.  986. 1004.  -487.            7.46</span></code></pre></div>
<p>Of course you can always change the type of objective function that nlmixr uses:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/setOfv.html">setOfv</a></span>(fit,<span class="st">"gauss3_1.6"</span>) <span class="co"># Setting objective function to gauss3_1.6</span></code></pre></div>
<p>By setting it back to the SAEM default objective function of <code>gauss3_1.6</code>, the <code><a href="https://www.rdocumentation.org/packages/generics/topics/glance">glance(fit)</a></code> has the same values again:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/generics/topics/glance">glance</a></span>(fit)
<span class="co">#&gt; # A tibble: 1 x 5</span>
<span class="co">#&gt;    OBJF   AIC   BIC logLik conditionNumber</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;           &lt;dbl&gt;</span>
<span class="co">#&gt; 1  722. 1019. 1037.  -503.            7.46</span></code></pre></div>
<p>For convenience, you can do this while you <code>glance</code> at the objects:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/generics/topics/glance">glance</a></span>(fit, <span class="dt">type=</span><span class="st">"FOCEi"</span>)
<span class="co">#&gt; # A tibble: 1 x 5</span>
<span class="co">#&gt;    OBJF   AIC   BIC logLik conditionNumber</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;           &lt;dbl&gt;</span>
<span class="co">#&gt; 1  689.  986. 1004.  -487.            7.46</span></code></pre></div>
</div>
<div id="tidying-the-model-parameters" class="section level1">
<h1 class="hasAnchor">
<a href="#tidying-the-model-parameters" class="anchor"></a>Tidying the model parameters</h1>
<div id="tidying-of-overall-fit-parameters" class="section level2">
<h2 class="hasAnchor">
<a href="#tidying-of-overall-fit-parameters" class="anchor"></a>Tidying of overall fit parameters</h2>
<p>You can also tidy the model estimates into a data frame with broom for processing. This can be useful when integrating into 3rd parting modeling packages. With a consistent parameter format, tasks for multiple types of models can be automated and applied.</p>
<p>The default function for this is <code>tidy</code>, which when applied to the <code>fit</code> object provides the overall parameter information in a tidy dataset:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/generics/topics/tidy">tidy</a></span>(fit)
<span class="co">#&gt; # A tibble: 6 x 5</span>
<span class="co">#&gt;   effect   group         term              estimate std.error</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;         &lt;chr&gt;                &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1 fixed    &lt;NA&gt;          tcl                0.00674  0.000446</span>
<span class="co">#&gt; 2 fixed    &lt;NA&gt;          tv                 1.42     0.0734  </span>
<span class="co">#&gt; 3 ran_pars ID            sd__eta.cl         0.496   NA       </span>
<span class="co">#&gt; 4 ran_pars ID            sd__eta.v          0.392   NA       </span>
<span class="co">#&gt; 5 ran_pars ID            cor__eta.v.eta.cl  0.986   NA       </span>
<span class="co">#&gt; 6 ran_pars Residual(add) add.err            2.84    NA</span></code></pre></div>
<p>nlmixr converts the log-transformed estimates to the normal scale for these tidy summaries, just like what was done for the <code>fit$parFixedDf</code> data frame. Unlike that data-frame, the standard errors are also transformed by an approximation to the normal scale.</p>
<p>By default, this only applies to parameters that nlmixr has determined are on a log-scale (those that are not are not included in the transformation). This behavior can be turned on or off with the <code>exponentiate</code> argument.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/generics/topics/tidy">tidy</a></span>(fit, <span class="dt">exponentiate=</span><span class="ot">FALSE</span>) ## No transformation applied
<span class="co">#&gt; # A tibble: 6 x 5</span>
<span class="co">#&gt;   effect   group         term              estimate std.error</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;         &lt;chr&gt;                &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1 fixed    &lt;NA&gt;          tcl                 -5.00     0.0661</span>
<span class="co">#&gt; 2 fixed    &lt;NA&gt;          tv                   0.347    0.0518</span>
<span class="co">#&gt; 3 ran_pars ID            sd__eta.cl           0.496   NA     </span>
<span class="co">#&gt; 4 ran_pars ID            sd__eta.v            0.392   NA     </span>
<span class="co">#&gt; 5 ran_pars ID            cor__eta.v.eta.cl    0.986   NA     </span>
<span class="co">#&gt; 6 ran_pars Residual(add) add.err              2.84    NA</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/generics/topics/tidy">tidy</a></span>(fit, <span class="dt">exponentiate=</span><span class="ot">TRUE</span>) ## No transformation applied on every parameter
<span class="co">#&gt; # A tibble: 6 x 5</span>
<span class="co">#&gt;   effect   group         term              estimate std.error</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;         &lt;chr&gt;                &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1 fixed    &lt;NA&gt;          tcl                0.00674  0.000446</span>
<span class="co">#&gt; 2 fixed    &lt;NA&gt;          tv                 1.42     0.0734  </span>
<span class="co">#&gt; 3 ran_pars ID            sd__eta.cl         0.496   NA       </span>
<span class="co">#&gt; 4 ran_pars ID            sd__eta.v          0.392   NA       </span>
<span class="co">#&gt; 5 ran_pars ID            cor__eta.v.eta.cl  0.986   NA       </span>
<span class="co">#&gt; 6 ran_pars Residual(add) add.err            2.84    NA</span></code></pre></div>
<p>Note that the default is <code>exponentiate=NA</code> which is adaptive exponentiation.</p>
<p>Also note, at the time of this writing the default separator between variables is <code>.</code>, which doesnâ€™t work well with this model giving <code>cor__eta.v.eta.cl</code>. You can easily change this by:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/options">options</a></span>(<span class="dt">broom.mixed.sep2=</span><span class="st">".."</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/generics/topics/tidy">tidy</a></span>(fit)
<span class="co">#&gt; # A tibble: 6 x 5</span>
<span class="co">#&gt;   effect   group         term               estimate std.error</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;         &lt;chr&gt;                 &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1 fixed    &lt;NA&gt;          tcl                 0.00674  0.000446</span>
<span class="co">#&gt; 2 fixed    &lt;NA&gt;          tv                  1.42     0.0734  </span>
<span class="co">#&gt; 3 ran_pars ID            sd__eta.cl          0.496   NA       </span>
<span class="co">#&gt; 4 ran_pars ID            sd__eta.v           0.392   NA       </span>
<span class="co">#&gt; 5 ran_pars ID            cor__eta.v..eta.cl  0.986   NA       </span>
<span class="co">#&gt; 6 ran_pars Residual(add) add.err             2.84    NA</span></code></pre></div>
<p>This gives an easier way to parse value: <code>cor__eta.v..eta.cl</code></p>
</div>
<div id="adding-a-confidence-interval-to-the-parameters" class="section level2">
<h2 class="hasAnchor">
<a href="#adding-a-confidence-interval-to-the-parameters" class="anchor"></a>Adding a confidence interval to the parameters</h2>
<p>The default R method <code>confint</code> works with nlmixr fit objects:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/confint">confint</a></span>(fit)
<span class="co">#&gt;          model.est    estimate       2.5 %      97.5 %</span>
<span class="co">#&gt; tcl     -5.0001838 0.006736709 0.005917697 0.007669072</span>
<span class="co">#&gt; tv       0.3472636 1.415189661 1.278458475 1.566544252</span>
<span class="co">#&gt; add.err  2.8404780 2.840477980          NA          NA</span></code></pre></div>
<p>This transforms the variables as described above. You can still use the <code>exponentiate</code> parameter to control the display of the confidence interval:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/confint">confint</a></span>(fit, <span class="dt">exponentiate=</span><span class="ot">FALSE</span>)
<span class="co">#&gt;          model.est    estimate     2.5 %     97.5 %</span>
<span class="co">#&gt; tcl     -5.0001838 0.006736709 -5.129808 -4.8705596</span>
<span class="co">#&gt; tv       0.3472636 1.415189661  0.245655  0.4488721</span>
<span class="co">#&gt; add.err  2.8404780 2.840477980        NA         NA</span></code></pre></div>
<p>However, broom has also implemented it own way to make these data a tidy dataset. The easiest way to get these values in a nlmixr dataset is to use:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/generics/topics/tidy">tidy</a></span>(fit, <span class="dt">conf.level=</span><span class="fl">0.9</span>)
<span class="co">#&gt; # A tibble: 6 x 7</span>
<span class="co">#&gt;   effect   group       term           estimate std.error conf.low conf.high</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;       &lt;chr&gt;             &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1 fixed    &lt;NA&gt;        tcl             0.00674  0.000446  0.00604   0.00751</span>
<span class="co">#&gt; 2 fixed    &lt;NA&gt;        tv              1.42     0.0734    1.30      1.54   </span>
<span class="co">#&gt; 3 ran_pars ID          sd__eta.cl      0.496   NA        NA        NA      </span>
<span class="co">#&gt; 4 ran_pars ID          sd__eta.v       0.392   NA        NA        NA      </span>
<span class="co">#&gt; 5 ran_pars ID          cor__eta.v..eâ€¦  0.986   NA        NA        NA      </span>
<span class="co">#&gt; 6 ran_pars Residual(aâ€¦ add.err         2.84    NA        NA        NA</span></code></pre></div>
<p>The confidence interval is on the scale specified by <code>exponentiate</code>, by default the adaptive scale.</p>
</div>
</div>
<div id="extracting-other-model-information-with-tidy" class="section level1">
<h1 class="hasAnchor">
<a href="#extracting-other-model-information-with-tidy" class="anchor"></a>Extracting other model information with <code>tidy</code>
</h1>
<p>The type of information that is extracted can be controlled by the <code>effects</code> argument. ## Extracting only fixed effect parameters</p>
<p>The fixed effect parameters can be extracted by <code>effects="fixed"</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/generics/topics/tidy">tidy</a></span>(fit, <span class="dt">effects=</span><span class="st">"fixed"</span>)
<span class="co">#&gt; # A tibble: 2 x 4</span>
<span class="co">#&gt;   effect term  estimate std.error</span>
<span class="co">#&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1 fixed  tcl    0.00674  0.000446</span>
<span class="co">#&gt; 2 fixed  tv     1.42     0.0734</span></code></pre></div>
<div id="extracting-only-random-parameters" class="section level2">
<h2 class="hasAnchor">
<a href="#extracting-only-random-parameters" class="anchor"></a>Extracting only random parameters</h2>
<p>The random standard deviations can be extracted by <code>effects="ran_pars"</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/generics/topics/tidy">tidy</a></span>(fit, <span class="dt">effects=</span><span class="st">"ran_pars"</span>)
<span class="co">#&gt; # A tibble: 4 x 4</span>
<span class="co">#&gt;   effect   group         term               estimate</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;         &lt;chr&gt;                 &lt;dbl&gt;</span>
<span class="co">#&gt; 1 ran_pars ID            sd__eta.cl            0.496</span>
<span class="co">#&gt; 2 ran_pars ID            sd__eta.v             0.392</span>
<span class="co">#&gt; 3 ran_pars ID            cor__eta.v..eta.cl    0.986</span>
<span class="co">#&gt; 4 ran_pars Residual(add) add.err               2.84</span></code></pre></div>
</div>
<div id="extracting-random-values-also-called-etas" class="section level2">
<h2 class="hasAnchor">
<a href="#extracting-random-values-also-called-etas" class="anchor"></a>Extracting random values (also called ETAs)</h2>
<p>The random values, or in NONMEM the ETAs, can be extracted by <code>effects="ran_vals"</code> or <code>effects="random"</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/generics/topics/tidy">tidy</a></span>(fit, <span class="dt">effects=</span><span class="st">"ran_vals"</span>)
<span class="co">#&gt; # A tibble: 118 x 5</span>
<span class="co">#&gt;    effect   group level term   estimate</span>
<span class="co">#&gt;    &lt;chr&gt;    &lt;fct&gt; &lt;int&gt; &lt;fct&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1 ran_vals ID        1 eta.cl  -0.0731</span>
<span class="co">#&gt;  2 ran_vals ID        2 eta.cl  -0.215 </span>
<span class="co">#&gt;  3 ran_vals ID        3 eta.cl   0.258 </span>
<span class="co">#&gt;  4 ran_vals ID        4 eta.cl  -0.540 </span>
<span class="co">#&gt;  5 ran_vals ID        5 eta.cl   0.320 </span>
<span class="co">#&gt;  6 ran_vals ID        6 eta.cl  -0.122 </span>
<span class="co">#&gt;  7 ran_vals ID        7 eta.cl  -0.315 </span>
<span class="co">#&gt;  8 ran_vals ID        8 eta.cl  -0.394 </span>
<span class="co">#&gt;  9 ran_vals ID        9 eta.cl  -0.254 </span>
<span class="co">#&gt; 10 ran_vals ID       10 eta.cl  -0.0227</span>
<span class="co">#&gt; # â€¦ with 108 more rows</span></code></pre></div>
<p>This duplicate method of running <code>effects</code> is because the <code>broom</code> package supports <code>effects="random"</code> while the <code>broom.mixed</code> package supports <code>effects="ran_vals"</code>.</p>
</div>
<div id="extracting-random-coefficients" class="section level2">
<h2 class="hasAnchor">
<a href="#extracting-random-coefficients" class="anchor"></a>Extracting random coefficients</h2>
<p>Random coefficients are the population fixed effect parameter + the random effect parameter, possibly transformed to the correct scale.</p>
<p>In this case we can extract this information from a nlmixr fit object by:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/generics/topics/tidy">tidy</a></span>(fit, <span class="dt">effects=</span><span class="st">"ran_coef"</span>)
<span class="co">#&gt; # A tibble: 118 x 5</span>
<span class="co">#&gt;    effect   group level term  estimate</span>
<span class="co">#&gt;    &lt;chr&gt;    &lt;fct&gt; &lt;int&gt; &lt;fct&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt;  1 ran_coef ID        1 tcl    0.00626</span>
<span class="co">#&gt;  2 ran_coef ID        2 tcl    0.00543</span>
<span class="co">#&gt;  3 ran_coef ID        3 tcl    0.00872</span>
<span class="co">#&gt;  4 ran_coef ID        4 tcl    0.00392</span>
<span class="co">#&gt;  5 ran_coef ID        5 tcl    0.00928</span>
<span class="co">#&gt;  6 ran_coef ID        6 tcl    0.00596</span>
<span class="co">#&gt;  7 ran_coef ID        7 tcl    0.00492</span>
<span class="co">#&gt;  8 ran_coef ID        8 tcl    0.00454</span>
<span class="co">#&gt;  9 ran_coef ID        9 tcl    0.00523</span>
<span class="co">#&gt; 10 ran_coef ID       10 tcl    0.00659</span>
<span class="co">#&gt; # â€¦ with 108 more rows</span></code></pre></div>
<p>This can also be changed by the <code>exponentiate</code> argument</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/generics/topics/tidy">tidy</a></span>(fit, <span class="dt">effects=</span><span class="st">"ran_coef"</span>, <span class="dt">exponentiate=</span><span class="ot">FALSE</span>)
<span class="co">#&gt; # A tibble: 118 x 5</span>
<span class="co">#&gt;    effect   group level term  estimate</span>
<span class="co">#&gt;    &lt;chr&gt;    &lt;fct&gt; &lt;int&gt; &lt;fct&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt;  1 ran_coef ID        1 tcl      -5.07</span>
<span class="co">#&gt;  2 ran_coef ID        2 tcl      -5.21</span>
<span class="co">#&gt;  3 ran_coef ID        3 tcl      -4.74</span>
<span class="co">#&gt;  4 ran_coef ID        4 tcl      -5.54</span>
<span class="co">#&gt;  5 ran_coef ID        5 tcl      -4.68</span>
<span class="co">#&gt;  6 ran_coef ID        6 tcl      -5.12</span>
<span class="co">#&gt;  7 ran_coef ID        7 tcl      -5.32</span>
<span class="co">#&gt;  8 ran_coef ID        8 tcl      -5.39</span>
<span class="co">#&gt;  9 ran_coef ID        9 tcl      -5.25</span>
<span class="co">#&gt; 10 ran_coef ID       10 tcl      -5.02</span>
<span class="co">#&gt; # â€¦ with 108 more rows</span></code></pre></div>
</div>
</div>
<div id="an-example-of-using-a-tidy-model-estimates-for-other-packages" class="section level1">
<h1 class="hasAnchor">
<a href="#an-example-of-using-a-tidy-model-estimates-for-other-packages" class="anchor"></a>An example of using a tidy model estimates for other packages</h1>
<p>As explained above, this standard format makes it easier for tidyverse packages to interact with model information. An example of this is piping the tidy information to dplyr to filter the effects and then to the <code>dotwhisker</code> package to plot the model parameter confidence intervals.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dotwhisker)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
fit <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/generics/topics/tidy">tidy</a></span>() <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(effect<span class="op">==</span><span class="st">"fixed"</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/dotwhisker/topics/dwplot">dwplot</a></span>()</code></pre></div>
<p><img src="broom_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
<p>Happy tidying!</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#the-broom-and-broom-mixed-packages">The broom and broom.mixed packages</a></li>
      <li><a href="#glancing-at-the-goodness-of-fit-metrics">Glancing at the goodness of fit metrics</a></li>
      <li>
<a href="#tidying-the-model-parameters">Tidying the model parameters</a><ul class="nav nav-pills nav-stacked">
<li><a href="#tidying-of-overall-fit-parameters">Tidying of overall fit parameters</a></li>
      <li><a href="#adding-a-confidence-interval-to-the-parameters">Adding a confidence interval to the parameters</a></li>
      </ul>
</li>
      <li>
<a href="#extracting-other-model-information-with-tidy">Extracting other model information with <code>tidy</code></a><ul class="nav nav-pills nav-stacked">
<li><a href="#extracting-only-random-parameters">Extracting only random parameters</a></li>
      <li><a href="#extracting-random-values-also-called-etas">Extracting random values (also called ETAs)</a></li>
      <li><a href="#extracting-random-coefficients">Extracting random coefficients</a></li>
      </ul>
</li>
      <li><a href="#an-example-of-using-a-tidy-model-estimates-for-other-packages">An example of using a tidy model estimates for other packages</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Matthew Fidler, Yuan Xiong, Rik Schoemaker, Justin Wilkins, Mirjam Trame, Richard Hooijmaijers, Teun Post, Wenping Wang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
